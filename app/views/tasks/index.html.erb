<%= javascript_include_tag 'tasks/index' %>
<%= stylesheet_link_tag 'tasks/index' %>

<% @projects.each do |project| %>
<% next if project.task_list.empty? %>
<script type="text/javascript">
$(function () {
  Tasks.makeSortable("project_<%= project.id %>_tasks");
});
</script>
<table id="project_<%= project.id %>_tasks" class="task_list">
  <thead>
    <tr>
      <th colspan="5"><%= link_to project.title, project_url(project) %></th>
    </tr>
  </thead>
  <!--tfoot>
    <tr>
      <td colspan="5" class="add_task">Add task</td>
    </tr>
  </tfoot-->
  <tbody>
    <% project.task_list.each do |list_item| %>
    <% task = list_item.task %>
    <tr id="list_item_<%= list_item.id %>">
      <td class="drag_handle">
        <% if task.assignee == viewer %>
          <% form_tag complete_task_url(task) do %>
            <%= check_box_tag "complete_task_id", false, false,
              :onclick => "$(this).parents('form').submit(); return false;" %>
          <% end %>
        <% else %>
          <%= image_tag 'drag_handle.gif' %>
        <% end %>
      </td>
      <td class="task_name"><%= link_to h(task.title), task_path(task) %></td>
      <td class="task_assignee"><%= h task.assignee.name %></td>
      <td class="task_estimate"><%= task.estimate %></td>
      <td class="task_due"><%=
        task.due_date.strftime("%b %e") if task.due_date %></td>
    </tr>
    <% end %>
  </tbody>
</table>
<% end %>
